<h1>Your User Profile</h1>

<div class="profile_head">
  <% if Current.user.avatar.attached? %>
    <%= image_tag Current.user.avatar.variant(resize_to_fill: [100,100]) ,class: "user_avatar"%>
  <%end %>

  <p class="profile_username"><%= Current.user.username %></p>
</div>

<div class="tab-container">
  <div class="tab active_tab" onclick="showContent(0)"><i class="fa-solid fa-images"></i>  Your Photos</div>
  <div class="tab" onclick="showContent(1)"><i class="fa-solid fa-trophy"></i>  Your Achievements</div>
  <div class="tab" onclick="showContent(2)"><i class="fa-solid fa-chart-simple"></i>  Your Stats</div>
</div>
<div class="profile_content user_photos" id="profile-1">
  <% if Current.user.train_stations.length > 0%>
    <%Current.user.train_stations.each do |station| %>
      <div class="profile_station_entry">
        <div class="entry_column_left">
          <h3 class="station">
            <%= link_to "#{station.name}", "/map?country=#{station.country}&station=#{station.osm_id}"%>
            <img class="country-flag" src="https://flagsapi.com/<%= station.country %>/flat/32.png" alt='<%= "Flag of #{station.country}" %>'>
          </h3>

          <p><i class="fa-fw fa-solid fa-train"></i> <b>Type</b>: <%= station.station_type.capitalize %></p>

          <% unless station.operator.empty? %>
            <p><i class="fa-fw fa-solid fa-building"></i> <b>Operator</b>: <%=  station.operator  %></p>
          <% end %>
          <p class="score"><i class="fa-fw fa-solid fa-star"></i> Score: 12 pts</p>

        </div>
        <div class="entry_column_right">
          <%= image_tag station.image.variant(resize_to_fit: [200,200]) ,class: "profile_station_photo", onclick: "openModal('#{url_for(station.image)}')"%>
        </div>
      </div>
    <%end %>
  <%else%>
    <div class="no_entries">
      <p>You dont have any photos, yet...</p>
      <i class="fa-solid fa-image"></i>
    </div>
  <% end %>
</div>
<div class="profile_content user_achievements" id="profile-2">
  <h2>Achievements</h2>
  <p>Fuck achievements</p>
</div>
<div class="profile_content user_achievements" id="profile-3">
  <h2>Statistics</h2>
  <p>Maybe some nice stats here</p>
</div>

<div id="photoViewWrapper" class="modal">
  <span class="close" onclick="closeModal()">&times;</span>
  <img class="modal-content" id="modalImage">
</div>

<script>
    let currentTab = 0;

    function showContent(tabIndex) {
        document.getElementById(`profile-${currentTab + 1}`).style.display = 'none';
        document.getElementById(`profile-${tabIndex + 1}`).style.display = 'block';
        document.getElementsByClassName('tab')[currentTab].classList.remove('active_tab');
        document.getElementsByClassName('tab')[tabIndex].classList.add('active_tab');
        currentTab = tabIndex;

    }
    showContent(0);

    function openModal(url) {
        var modal = document.getElementById("photoViewWrapper");
        var modalImage = document.getElementById("modalImage");
        modal.style.display = "flex";
        modalImage.src = url;
    }

    // Function to close the modal
    function closeModal() {
        var modal = document.getElementById("photoViewWrapper");
        modal.style.display = "none";
    }

    // Close the modal when clicking outside of the modal content
    window.onclick = function(event) {
        var modal = document.getElementById("photoViewWrapper");
        if (event.target == modal) {
            closeModal();
        }
    }
</script>

